{"name":"Php-basicsql","tagline":"A very basic MySQLi wrapper with some reporting tools/callbacks","body":"php-basicSQL\r\n============\r\n\r\nA very basic MySQLi wrapper with some reporting tools/callbacks\r\n\r\nThis static class provides a MySQLi interface with query() function that accepts pure SQL. It then stores the query along with statistics such as execute time, number of rows affected etc. At the end of execution, you can call report() to get an array of statistics. It also has callbacks for errors, queries, and slow_queries where your script can decide what to do (log, abort etc).\r\n\r\n#### What it does not [yet?] do\r\n\r\n\r\n* Any form in SQL injection protection. This is up to you\r\n* Add framework style functions\r\n* Use prepared statements\r\n\r\n#### What it does do (usage)\r\n\r\n##### Include the class, and load up the DB\r\n```php\r\ninclude('basicSQL.php');\r\n\r\nbasicSQL::Connect( array(\r\n    'database'=>'mydb', 'host'=>'myhost', 'port', 'user'=>'myuser', 'password'=>'mypass', // these can be in php.ini\r\n    'error_callback' => 'handle_error',\r\n    'slow_query_callback' => 'handle_slow', slow_query_time => 7, // queries longer than 7 seconds callback here\r\n    'query_callback' => array('StaticLogClass','LogQueries'),\r\n    'error_log_length' => 20, 'query_log_length'=>20 // store the last X queries/errors (default 100)\r\n    ));\r\n```\r\n\r\n##### Write some callbacks, optional of course\r\n\r\n```php\r\n// if we cant connect the might as well just die, otherwise we just echo the error to screen\r\nfunction handle_error($e=array()) {\r\n    if ($e['type']=='connect']) { \r\n      die(\"{$e['no']} : {$e['error']} \\n\");\r\n    }\r\n    echo \"SQL Error on '{$r['type']}' query {$e['no']} : {$e['error']} \\nThe query was {$e['query']}\\n\");\r\n}\r\n\r\n// we want to log slow queries\r\nfunction handle_slow($q=array()) {\r\n    StaticLogClass::LogQueries(\"Slow query took {$q['exec_time']} to complete: {$q['query']});\r\n}\r\n\r\n```\r\n\r\n##### Now your script does stuff\r\n\r\n```php\r\n\r\nif ($result = basicSQL::query(\"SELECT id FROM users WHERE name='fred'\")) {\r\n  // do stuff\r\n} else {\r\n  print_r(basicSQL::lastError()); // if you don't have a call_back you get get last error like so\r\n}\r\nbasicSQL::query(\"DELETE FROM users WHERE name='fred'\");\r\n\r\n```\r\n\r\n##### At the end of the script we can have a look at the report\r\n\r\n```php\r\nprint_r(basicSQL::report());\r\nArray\r\n(\r\n    [exec_time] => 0.0018630000000001\r\n    [errors] => 0\r\n    [warnings] => 0\r\n    [slow_queries] => 1\r\n    [selects] => 1\r\n    [updates] => 0\r\n    [inserts] => 0\r\n    [deletes] => 1\r\n)\r\n```\r\n##### Or view the query / error / slow_queries logs\r\n```php\r\nprint_r(basicSQL::errorLog());\r\n\r\nprint_r(basicSQL::queryLog());\r\nArray\r\n(\r\n    [0] => Array\r\n        (\r\n            [time] => 1397200192\r\n            [type] => select\r\n            [query] => SELECT id FROM users WHERE name='fred'\r\n            [num_rows] => 1\r\n            [field_count] => 1\r\n            [exec_time] => 10.00054899999999999\r\n        )\r\n    [1] => Array\r\n            [time] => 1397200192\r\n            [type] => delete\r\n            [query] => DELETE FROM users WHERE name='fred'\r\n            [exec_time] => 0.00023000000000001\r\n        )\r\n)\r\n\r\n\r\nprint_r(basicSQL::slowQueryLog()); // depending on query_log_length, the may no longer be stored\r\nArray\r\n(\r\n    [0] => Array\r\n        (\r\n            [time] => 1397200192\r\n            [type] => select\r\n            [query] => SELECT id FROM users WHERE name='fred'\r\n            [num_rows] => 1\r\n            [field_count] => 1\r\n            [exec_time] => 10.00054899999999999\r\n        )\r\n)\r\n```\r\n\r\n##### And thats it, for the moment.","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}